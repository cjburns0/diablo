<html lang="en"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mount Diablo Challenge Analytics</title>
  <meta name="theme-color" content="#ffffff">
  <link rel="icon" type="image/png" href="assets/logo.png">
  <link rel="apple-touch-icon" href="assets/logo.png">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- UploadThingy Widget -->
  <script>window.UPLOADTHINGY_API_URL = 'https://app.uploadthingy.com';</script>
  <script src="https://app.uploadthingy.com/static/js/uploadthingy-widget.js"></script>
</head>
<body class="antialiased selection:bg-slate-900 selection:text-white bg-black text-slate-100" style="font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;">
  <!-- App Shell -->
  <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/60 border-b bg-black/90 border-slate-800">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="assets/logo.png" alt="Mt. Diablo Challenge Logo" class="h-10 w-10 rounded-md">
        <div class="text-[20px] sm:text-[22px] font-semibold tracking-tight whitespace-nowrap">Mt. Diablo Challenge</div>
        <!-- Navigation links - commented out for future use
        <div class="hidden md:flex items-center gap-6 pl-6 ml-4 border-l border-slate-800">
          <a href="#overview" class="text-sm font-medium text-slate-400 hover:text-slate-100">Overview</a>
          <a href="#trends" class="text-sm font-medium text-slate-400 hover:text-slate-100">Trends</a>
          <a href="#weather" class="text-sm font-medium text-slate-400 hover:text-slate-100">Weather Impact</a>
        </div>
        -->
      </div>
      <div class="flex items-center gap-3">
        <button id="uploadButton" class="inline-flex items-center gap-1.5 text-sm font-medium border rounded-md px-3 py-1.5 text-slate-100 border-sky-700 bg-sky-900 hover:bg-sky-800">
          <i data-lucide="upload" class="w-4 h-4 text-sky-400"></i>
          Send Files Here
        </button>
        <div class="hidden sm:flex items-center px-2.5 py-1.5 border rounded-md shadow-sm/50 border-slate-700 bg-slate-900 opacity-50 cursor-not-allowed">
          <i data-lucide="search" class="w-4 h-4 text-slate-500"></i>
          <input type="text" placeholder="Search races, years, riders…" class="ml-2 text-sm placeholder:text-slate-500 focus:outline-none bg-transparent w-64 cursor-not-allowed" disabled>
        </div>
        <!-- Export button - commented out for future use
        <button class="inline-flex items-center gap-1.5 text-sm font-medium border rounded-md px-2.5 py-1.5 text-slate-300 border-slate-800 hover:bg-slate-950">
          <i data-lucide="download" class="w-4 h-4 text-slate-400"></i>
          Export
        </button>
        -->
      </div>
    </div>
  </header>

  <!-- Upload Modal -->
  <div id="uploadModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
    <div class="relative w-full max-w-2xl mx-4 rounded-xl border shadow-xl border-slate-800 bg-black p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-slate-100">Upload Files</h2>
        <button id="closeModal" class="text-slate-400 hover:text-slate-100">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>
      <!-- UploadThingy Widget -->
      <div id="uploadthingy-widget" data-domain="diablochallenge.com"></div>
    </div>
  </div>

  <!-- Main -->
  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
    <!-- Heading + KPI -->
    <section class="mb-8">
      <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6">
        <div>
          <h1 class="text-[28px] md:text-[32px] font-semibold tracking-tight text-slate-100">Mount Diablo Challenge Analytics</h1>
          <p class="text-sm md:text-base mt-1 text-slate-400">11.2-mile climbing time trial with 3,249 ft elevation gain. Compare finish times across years and analyze wind's impact on performance.</p>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 w-full md:w-auto">
          <div class="rounded-lg border p-3 shadow-sm hover:shadow transition border-slate-800 bg-black">
            <div class="text-[11px] uppercase tracking-wide text-slate-500">Fastest Year</div>
            <div class="mt-1 flex items-baseline gap-2">
              <div class="text-xl font-semibold tabular-nums" id="kpi-fastest-year">Loading...</div>
              <div class="text-xs text-emerald-400" id="kpi-fastest-pct">—</div>
            </div>
          </div>
          <div class="rounded-lg border p-3 shadow-sm hover:shadow transition border-slate-800 bg-black">
            <div class="flex items-center gap-1.5 text-[11px] uppercase tracking-wide text-slate-500">
              <span>Wind Impact</span>
              <div class="relative group">
                <i data-lucide="info" class="w-3 h-3 text-slate-500 cursor-help"></i>
                <div class="absolute left-0 top-5 hidden group-hover:block w-56 bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-xs normal-case tracking-normal shadow-lg z-50">
                  <div class="text-slate-200 font-normal">Correlation coefficient (r) shows the relationship between wind speed and finish times. Negative values mean higher wind is associated with slower times. r = -0.45 indicates 45% correlation strength.</div>
                </div>
              </div>
            </div>
            <div class="mt-1 flex items-baseline gap-2">
              <div class="text-xl font-semibold tabular-nums" id="kpi-wind-corr">r = —</div>
              <div class="text-xs text-slate-500">Lower wind → faster</div>
            </div>
          </div>
          <div class="rounded-lg border p-3 shadow hover:shadow transition border-slate-800 bg-black">
            <div class="text-[11px] uppercase tracking-wide text-slate-500">Median Time</div>
            <div class="mt-1 flex items-baseline gap-2">
              <div class="text-xl font-semibold tabular-nums" id="kpi-median-time">—</div>
              <div class="text-xs text-slate-500" id="kpi-fastest-time">Fastest: —</div>
            </div>
          </div>
          <div class="rounded-lg border p-3 shadow-sm hover:shadow transition border-slate-800 bg-black">
            <div class="text-[11px] uppercase tracking-wide text-slate-500">Sample Size</div>
            <div class="mt-1 flex items-baseline gap-2">
              <div class="text-xl font-semibold tabular-nums" id="kpi-total-years">— yrs</div>
              <div class="text-xs text-slate-500" id="kpi-year-range">—</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Chart -->
    <section class="mb-6">
      <!-- Main Chart Card -->
      <div class="rounded-xl border shadow-sm border-slate-800 bg-black">
        <div class="flex items-center justify-between px-4 sm:px-5 py-3 border-b border-slate-800">
          <div class="flex items-center gap-2">
            <i data-lucide="line-chart" class="w-4 h-4 text-slate-400"></i>
            <div class="text-sm font-medium text-slate-200">Finish Time by Year</div>
          </div>
          <div class="flex items-center gap-2">
            <div class="flex items-center gap-1 rounded-md border p-1 border-slate-800">
              <button id="toggle-wind" class="inline-flex items-center gap-1.5 px-2.5 py-1.5 text-xs font-medium rounded text-slate-300 hover:bg-slate-950 bg-sky-900" aria-pressed="true">
                <i data-lucide="wind" class="w-3.5 h-3.5 text-sky-400"></i> Wind Overlay
              </button>
              <div class="relative group px-1">
                <i data-lucide="info" class="w-3.5 h-3.5 text-slate-500 cursor-help"></i>
                <div class="absolute right-0 top-8 hidden group-hover:block w-72 bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-xs shadow-xl z-50">
                  <div class="flex items-start gap-2">
                    <i data-lucide="lightbulb" class="w-4 h-4 text-amber-500 flex-shrink-0 mt-0.5"></i>
                    <div>
                      <div class="font-medium text-slate-200 mb-1">About Wind Impact</div>
                      <p class="text-slate-400">Wind is the primary weather factor affecting climb times. The summit is particularly exposed to wind, which can add significant time to finishes. Toggle overlay to see correlation with performance.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="p-4 sm:p-6">
          <!-- Responsive Chart Wrapper -->
          <div class="relative">
            <div class="w-full rounded-lg ring-1 overflow-hidden ring-slate-800 bg-black relative">
              <!-- SVG Chart -->
              <svg id="main-chart" viewBox="0 0 960 550" class="w-full h-[550px]">
                <!-- Chart will be dynamically generated by JavaScript -->
              </svg>
              <!-- Tooltip -->
              <div id="chart-tooltip" class="absolute hidden bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-xs shadow-lg pointer-events-none z-50">
                <div id="tooltip-content" class="text-slate-200"></div>
              </div>
            </div>

            <!-- Legend -->
            <div class="mt-4 space-y-3">
              <!-- Legend Items -->
              <div class="flex flex-wrap justify-center items-center gap-x-6 gap-y-2.5 text-xs text-slate-400">
                <div class="flex items-center gap-2">
                  <span class="h-2 w-2 rounded-full flex-shrink-0" style="background-color:#ef4444;"></span>
                  <span><strong class="text-slate-300">Fastest time</strong> - Best finish that year</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="h-2 w-2 rounded-full flex-shrink-0" style="background-color:#eab308;"></span>
                  <span><strong class="text-slate-300">10th percentile</strong> - Top 10% of finishers</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="h-3 w-4 rounded-sm border flex-shrink-0" style="border-color:#64748b; background-color:rgba(148,163,184,0.08)"></span>
                  <span><strong class="text-slate-300">Box (IQR)</strong> - 25th to 75th percentile</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="h-2 w-2 rounded-full flex-shrink-0" style="background-color:#6366f1;"></span>
                  <span><strong class="text-slate-300">Mean</strong> - Average finish time</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="flex-shrink-0" style="color:#fbbf24; font-size:14px;">★</span>
                  <span><strong class="text-slate-300">Gold stars</strong> - Multi-year riders</span>
                </div>
              </div>

              <div class="flex flex-wrap justify-center items-center gap-x-6 gap-y-2.5 text-xs text-slate-400">
                <div class="flex items-center gap-2">
                  <span class="h-1.5 w-5 rounded-full flex-shrink-0" style="background-color:#0f766e;"></span>
                  <span><strong class="text-slate-300">Median line</strong> - 50th percentile trend</span>
                </div>
                <div class="flex items-center gap-1.5">
                  <span class="text-slate-300 font-medium">Wind overlay:</span>
                  <span class="h-3 w-4 rounded-sm flex-shrink-0" style="background-color:rgba(34, 197, 94, 0.25);"></span>
                  <span class="text-slate-400 text-xs">Tailwind</span>
                  <span class="h-3 w-4 rounded-sm flex-shrink-0" style="background-color:rgba(251, 191, 36, 0.25);"></span>
                  <span class="text-slate-400 text-xs">Crosswind</span>
                  <span class="h-3 w-4 rounded-sm flex-shrink-0" style="background-color:rgba(239, 68, 68, 0.25);"></span>
                  <span class="text-slate-400 text-xs">Headwind</span>
                </div>
                <div class="flex items-center gap-2">
                  <i data-lucide="info" class="w-3.5 h-3.5 text-slate-500 flex-shrink-0"></i>
                  <span class="text-slate-500">Y-axis inverted: faster times at top, slower at bottom</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Row 1: Rider Lookup | Course Direction | Wind Impact -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <!-- Rider Lookup -->
      <div class="rounded-xl border shadow-sm border-slate-800 bg-black">
        <div class="px-4 sm:px-5 py-3 border-b border-slate-800">
          <div class="flex items-center gap-2">
            <i data-lucide="user-search" class="w-4 h-4 text-slate-400"></i>
            <div class="text-sm font-medium text-slate-200">Rider Lookup</div>
          </div>
        </div>
        <div class="p-4 sm:p-5">
          <div class="relative">
            <input
              type="text"
              id="riderSearch"
              placeholder="Search for a rider..."
              class="w-full px-3 py-2 text-sm rounded-md border bg-black text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500 border-slate-800"
              autocomplete="off"
            />
            <div id="riderSearchResults" class="hidden absolute z-30 mt-1 w-full rounded-md border shadow-lg overflow-hidden border-slate-800 bg-black max-h-60 overflow-auto">
              <!-- Populated by JavaScript -->
            </div>
          </div>
          <p class="text-xs text-slate-500 mt-2">Search for riders with multiple years to compare year-over-year performance.</p>
        </div>
      </div>

      <!-- Course Direction -->
      <div class="rounded-xl border shadow-sm border-slate-800 bg-black">
        <div class="px-4 sm:px-5 py-3 border-b border-slate-800">
          <div class="flex items-center gap-2">
            <i data-lucide="compass" class="w-4 h-4 text-sky-400"></i>
            <div class="text-sm font-medium text-slate-200">Course Direction</div>
          </div>
        </div>
        <div class="p-4 sm:p-5 flex items-center justify-center">
          <div id="routeCompass" class="text-xs text-slate-500">
            Loading route data...
          </div>
        </div>
      </div>

      <!-- Wind Impact -->
      <div class="rounded-xl border shadow-sm border-slate-800 bg-black">
        <div class="px-4 sm:px-5 py-3 border-b border-slate-800">
          <div class="flex items-center gap-2">
            <i data-lucide="wind" class="w-4 h-4 text-sky-400"></i>
            <div class="text-sm font-medium text-slate-200">Wind Impact</div>
          </div>
        </div>
        <div class="p-4 sm:p-5">
          <div id="windBenefitBox" class="text-xs text-slate-500">
            Loading wind analysis...
          </div>
        </div>
      </div>
    </section>

    <!-- Row 2: Year Filters | YoY Delta | Performance Outliers -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Year Filters -->
      <div class="rounded-xl border shadow-sm border-slate-800 bg-black">
        <div class="px-4 sm:px-5 py-3 border-b flex items-center justify-between border-slate-800">
          <div class="flex items-center gap-2">
            <i data-lucide="sliders" class="w-4 h-4 text-slate-400"></i>
            <div class="text-sm font-medium text-slate-200">Year Filters</div>
          </div>
          <button id="resetFilters" class="text-xs font-medium text-slate-400 hover:text-slate-100">Reset</button>
        </div>
        <div class="p-4 sm:p-5 space-y-3">
          <!-- Years -->
          <div class="grid grid-cols-2 gap-3">
            <div class="space-y-1.5">
              <label class="text-xs font-medium text-slate-400">Start Year</label>
              <div class="relative">
                <button data-popover-button="#startYearMenu" class="w-full flex items-center justify-between px-3 py-2 rounded-md border text-sm border-slate-800 bg-black hover:bg-slate-950">
                  <span class="text-slate-200" id="startYearValue">2010</span>
                  <i data-lucide="chevron-down" class="w-4 h-4 text-slate-500"></i>
                </button>
                <div id="startYearMenu" data-popover="" class="hidden absolute z-20 mt-1 w-full rounded-md border shadow-md overflow-hidden border-slate-800 bg-black">
                  <ul class="max-h-60 overflow-auto py-1" id="startYearList"></ul>
                </div>
              </div>
            </div>
            <div class="space-y-1.5">
              <label class="text-xs font-medium text-slate-400">End Year</label>
              <div class="relative">
                <button data-popover-button="#endYearMenu" class="w-full flex items-center justify-between px-3 py-2 rounded-md border text-sm border-slate-800 bg-black hover:bg-slate-950">
                  <span class="text-slate-200" id="endYearValue">2024</span>
                  <i data-lucide="chevron-down" class="w-4 h-4 text-slate-500"></i>
                </button>
                <div id="endYearMenu" data-popover="" class="hidden absolute z-20 mt-1 w-full rounded-md border shadow-md overflow-hidden border-slate-800 bg-black">
                  <ul class="max-h-60 overflow-auto py-1" id="endYearList"></ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Apply -->
          <button id="applyFilters" class="w-full inline-flex items-center justify-center gap-2 rounded-md border px-3 py-2 text-sm font-medium border-slate-700 bg-black text-slate-200 hover:bg-slate-950">
            <i data-lucide="refresh-cw" class="w-4 h-4 text-slate-300"></i>
            Apply filters
          </button>

          <!-- Wind Correlation -->
          <div class="pt-2 border-t border-slate-800">
            <div class="flex items-center justify-between text-xs">
              <span class="text-slate-500">Wind Correlation</span>
              <span class="font-medium tabular-nums text-slate-300" id="filter-wind-corr">—</span>
            </div>
          </div>
        </div>
      </div>

      <!-- YoY Delta -->
      <div class="rounded-xl border shadow-sm border-slate-800 bg-black">
        <div class="px-4 sm:px-5 py-3 border-b border-slate-800">
          <div class="flex items-center gap-2">
            <i data-lucide="calendar" class="w-4 h-4 text-slate-400"></i>
            <div class="text-sm font-medium text-slate-200">Year-over-Year Delta</div>
          </div>
        </div>
        <div class="p-4 sm:p-5 space-y-2">
          <div class="flex items-center justify-between text-sm">
            <span class="text-slate-400">Last year vs prior</span>
            <span class="font-medium tabular-nums" id="yoy-last-year">—</span>
          </div>
          <div class="flex items-center justify-between text-sm">
            <span class="text-slate-400">Average annual change</span>
            <span class="font-medium tabular-nums text-slate-200" id="yoy-avg-change">—</span>
          </div>
          <div class="flex items-center justify-between text-sm">
            <span class="text-slate-400">Volatility (std dev)</span>
            <span class="font-medium tabular-nums text-slate-200" id="yoy-volatility">—</span>
          </div>
        </div>
      </div>

      <!-- Performance Outliers -->
      <div class="rounded-xl border shadow-sm border-slate-800 bg-black">
        <div class="px-4 sm:px-5 py-3 border-b border-slate-800">
          <div class="flex items-center gap-2">
            <i data-lucide="target" class="w-4 h-4 text-slate-400"></i>
            <div class="text-sm font-medium text-slate-200">Performance Outliers</div>
            <div class="relative group">
              <i data-lucide="info" class="w-3.5 h-3.5 text-slate-500 cursor-help"></i>
              <div class="absolute left-0 top-6 hidden group-hover:block w-64 bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-xs shadow-lg z-50">
                <div class="text-slate-200">Years shown are based on % difference from overall median time (77:03)</div>
              </div>
            </div>
          </div>
        </div>
        <div class="p-4 sm:p-5">
          <ul id="outliers-list" class="divide-y divide-slate-800">
            <!-- Populated by JavaScript -->
          </ul>
        </div>
      </div>
    </section>
  </main>

  <!-- Feedback Modal -->
  <div id="feedbackModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
    <div class="relative w-full max-w-md mx-4 rounded-xl border shadow-xl border-slate-800 bg-black p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-slate-100">Send Feedback</h2>
        <button id="closeFeedbackModal" class="text-slate-400 hover:text-slate-100">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>
      <p class="text-slate-300 text-sm mb-4">We'd love to hear from you! Please send your feedback, questions, or suggestions via email.</p>
      <div class="flex items-center gap-2 p-3 rounded-lg bg-slate-900 border border-slate-700">
        <i data-lucide="mail" class="w-5 h-5 text-sky-400 flex-shrink-0"></i>
        <span class="text-slate-200 font-medium">Colin at ThirdSouth.capital</span>
      </div>
    </div>
  </div>

  <!-- Rider Performance Modal -->
  <div id="riderModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
    <div class="relative w-full max-w-3xl mx-4 rounded-xl border shadow-xl border-slate-800 bg-black p-6">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <span class="text-amber-400 text-xl">★</span>
          <h2 class="text-xl font-semibold text-slate-100" id="riderModalName">Rider Performance</h2>
        </div>
        <button id="closeRiderModal" class="text-slate-400 hover:text-slate-100">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>

      <div id="riderModalContent" class="space-y-4 overflow-y-auto max-h-[60vh]">
        <!-- Populated by JavaScript -->
      </div>
    </div>
  </div>

  <footer class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">
    <div class="border-t pt-6 flex flex-col sm:flex-row items-center justify-between gap-3 border-slate-800">
      <div class="flex items-center gap-2 text-sm">
        <span class="text-slate-500">© <span class="tabular-nums">2025</span> VELODATA</span>
        <span class="text-slate-700">•</span>
        <span class="text-slate-500">Created by CJB</span>
      </div>
      <div class="flex items-center gap-4 text-sm">
        <button id="feedbackButton" class="text-slate-400 hover:text-slate-100 cursor-pointer">Feedback</button>
      </div>
    </div>
  </footer>

  <!-- Dashboard Application -->
  <script type="module" src="components/main.js"></script>
</body>
</html>
